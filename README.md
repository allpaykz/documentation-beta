### Добро пожаловать в вики allpay!

![](https://allpay.kz/frontend/main/images/bg_1_c.png)

Здесь вы найдете техническое описание бизнес процессов [allpay](https://allpay.kz/) и описание публичных API.
Этот документ предназначен для разработчиков желающих интегрироваться с платежной системой allpay.

Данный раздел служит для удобства навигации и содержит перечисление всех доступных интеграций в системе allpay. Каждый параграф состоит из

 - диаграммы движения денег(в прямоугольниках указана роль в системе allpay, а в прямоугольниках с закругленными краями - название операции)
 - краткого нетехнического описания интеграции
 - список документации необходимый и достаточный для написания интеграций.

#### Роли в системе allpay
| Роль | Описание |
| --- | --- |
| Клиент | Физическое лицо, зарегистрированное в системе allpay, владелец электронного кошелька и электронных денег |
| Агент | Юридическое лицо или индивидуальный предприниматель, зарегистрированный в системе allpay, который осуществляет пополнение и снятие электронных денег с кошельков клиентов |
| Мерчант | Юридическое лицо или индивидуальный предприниматель, зарегистрированный в системе allpay, принимающий электронные деньги allpay в качестве оплаты товаров и услуг |

### 1. Терминальные операции. Пополнение.

<img src="http://yuml.me/diagram/activity/[Agent(you)]->(Cash In)->[Client]"
     title="Передача денег от агента к клиенту"
     alt="Передача денег от агента к клиенту">

Данная операция может быть использована для пополнения счета произвольного клиента системы allpay по запросу агентской системы. Представляет собой по сути перевод денег в пользу клиента. Электронные деньги в результате операции будут списаны с агентского аккаунта от имени которого производилось пополнение.

 - [Общее описание терминальных платежей](TerminalPayment)
 - [Описание API пополнения через терминал](TerminalPaymentCashIn)

### 2. Терминальные операции. Оплата по номеру терминала.

<img src="http://yuml.me/diagram/activity/[Agent(you)]->(Cash In)->[Client]->(Pay by terminal id)->[Merchant]"
     title="Передача денег от агента к клиенту, а затем оплата этими деньгами услуг мерчанта по номеру терминала"
     alt="Передача денег от агента к клиенту, а затем оплата этими деньгами услуг мерчанта по номеру терминала">

Данная операция позволяет оплачивать на указанный терминал. Деньги списываются со счета агента от имени которого авторизован запрос и, пройдя через указанный в запросе счет клиента, оказываются на счету мерчанта, которому принадлежит терминал.

 - [Общее описание терминальных платежей](TerminalPayment)
 - [Описание API пополнения через терминал](TerminalPaymentPayForGoods)

### 3. Терминальная оплата услуг.

<img src="http://yuml.me/diagram/activity/[Agent(you)]->(Cash In)->[Client]->(Pay for services)->[Merchant]"
     title="Передача денег от агента к клиенту, а затем оплата этими деньгами коммунальных и других услуг"
     alt="Передача денег от агента к клиенту, а затем оплата этими деньгами коммунальных и других услуг">

Данная операция позволяет оплачивать услуги. Под услугами подразумевается, коммунальные услуги, телефон, пополение баланса на других сервисах и тд. Деньги списываются со счета агента от имени которого авторизован запрос и, пройдя через счет клиента, оказываются на счету мерчанта, чьи услуги необходимо оплатить.

По факту получения денег мерчант пополняет счет в пользу которого была оплата(уже вне системы allpay).

 - [Описание API оплаты услуг](%D0%9E%D0%BF%D0%BB%D0%B0%D1%82%D0%B0-%D1%83%D1%81%D0%BB%D1%83%D0%B3-%D1%87%D0%B5%D1%80%D0%B5%D0%B7-%D0%B0%D0%BF%D0%B8-%D1%82%D0%B5%D1%80%D0%BC%D0%B8%D0%BD%D0%B0%D0%BB%D0%BE%D0%B2)

### 4. Подключение allpay в качестве платежной опции к вашему магазину.

<img src="http://yuml.me/diagram/activity/[Client]->(Pay by terminal id)->[Merchant(you)]"
     title="Оплата товаров или услуг мерчанта с кошелька клиента"
     alt="Оплата товаров или услуг мерчанта с кошелька клиента">

Данная операция позволяет перенаправить клиента на сайт allpay для оплаты товаров или услуг мерчанта в стиле PayPal. На сайте мерчанта формируется запрос и клиент перенаправляется на сайт allpay для проведения оплаты. После оплаты система allpay уведомляет сайт мерчанта об успешно проведенной оплате.

 - [Описание API подключения allpay для оплаты](%D0%A0%D0%B5%D0%B3%D0%BB%D0%B0%D0%BC%D0%B5%D0%BD%D1%82-API-%D0%9C%D0%B5%D1%80%D1%87%D0%B0%D0%BD%D1%82%D0%B0%D0%BC)

### 5. Подключение к allpay в качестве мерчанта(провайдера услуг)

<img src="http://yuml.me/diagram/activity/[Client]->(Pay for services)->[Merchant(you)]"
     title="Передача денег от системы allpay мерчанту для проведения оплаты за коммунальные и другие услуги"
     alt="Передача денег от системы allpay мерчанту для проведения оплаты за коммунальные и другие услуги">

Данная интеграция подразумевает что система allpay является инициатором платежа, в то время как вы являетесь поставщиком услуг.

 - Здесь нет требований к сервису потому что обычно мы интегрируется с провайдерами.

### 6. Снятие со счета клиента в пользу агента(устарело)

<img src="http://yuml.me/diagram/activity/[Client]->(Cash Out)->[Agent(you)]"
     title="Передача денег от клиента агенту"
     alt="Передача денег от клиента агенту">

Данная интеграция позволяет мерчанту снимать деньги с клиента при предоставлении клиентом одноразового пароля который может быть сгенерирован в мобильном приложении allpay клиентом. В этой интеграции в отличии от других агентская система управляет жизненным циклом транзакций и должна завешать или отклонять транзакции.

- [Описание API пополенния и снятия денег](%D0%A0%D0%B5%D0%B3%D0%BB%D0%B0%D0%BC%D0%B5%D0%BD%D1%82-API-%D0%90%D0%B3%D0%B5%D0%BD%D1%82%D0%0B)
